---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Header from "@/components/sections/Header.astro";
import Footer from "@/components/sections/Footer.astro";
import { navItems, footerColumns } from "@/lib/navigation";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

const publishedDate = post.data.publishedAt.toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<BaseLayout
  title={`${post.data.title} â€” Handoff Blog`}
  description={post.data.excerpt}
>
  <Header navItems={navItems} />

  <article class="relative z-[2] pt-32 pb-2 px-4 bg-brand-800">
    <div class="max-w-[1920px] mx-auto bg-white rounded-3xl py-16 lg:py-24 overflow-hidden">
      <div class="max-w-[800px] mx-auto px-6 lg:px-8">
        <header class="mb-12" data-animate="fade-up">
          <h1 class="font-display text-4xl lg:text-5xl font-medium leading-tight tracking-[-0.96px] text-text-primary mb-6">
            {post.data.title}
          </h1>
          {(post.data.author || publishedDate) && (
            <p class="text-lg text-text-tertiary">
              {post.data.author && <span class="font-medium">{post.data.author}</span>}
              {post.data.author && publishedDate && <span> &middot; </span>}
              <time>{publishedDate}</time>
            </p>
          )}
        </header>

        {post.data.featuredImage && (
          <img
            src={post.data.featuredImage}
            alt={post.data.title}
            class="w-full rounded-xl mb-12"
          />
        )}

        <div class="prose prose-lg max-w-none" data-animate="fade-up">
          <Content />
        </div>
      </div>
    </div>
  </article>

  <Footer columns={footerColumns} />
</BaseLayout>

<script>
  import { initScrollAnimations } from "@/lib/animations";

  const header = document.getElementById("site-header");

  window.addEventListener("scroll", () => {
    if (header) {
      if (window.scrollY > 40) {
        header.classList.add("header-scrolled");
      } else {
        header.classList.remove("header-scrolled");
      }
    }
  });

  initScrollAnimations();
</script>
